{
  "DATABASE_NAME": "COMPONENT_LIBRARY",
  "VERSION": "2.0",
  "PURPOSE": "Готовые, протестированные Liquid компоненты для быстрой генерации тем",
  
  "PRODUCT_CARD": {
    "file_name": "product-card.liquid",
    "description": "Универсальная карточка продукта для коллекций",
    "parameters": ["product", "show_quick_add", "show_vendor", "image_ratio", "show_secondary_image"],
    "code": "{% comment %}\n  Product Card - snippets/product-card.liquid\n{% endcomment %}\n<div class=\"product-card\">\n  <a href=\"{{ product.url }}\" class=\"product-card__link\">\n    <div class=\"product-card__image-wrapper\">\n      {{ product.featured_image | image_url: width: 600 | image_tag: loading: 'lazy', class: 'product-card__image' }}\n      {% if show_secondary_image and product.images[1] %}\n        {{ product.images[1] | image_url: width: 600 | image_tag: class: 'product-card__image product-card__image--secondary' }}\n      {% endif %}\n      {% if product.compare_at_price > product.price %}\n        <span class=\"product-card__badge product-card__badge--sale\">SALE</span>\n      {% endif %}\n    </div>\n    <div class=\"product-card__info\">\n      <h3 class=\"product-card__title\">{{ product.title }}</h3>\n      <div class=\"product-card__price\">{{ product.price | money }}</div>\n    </div>\n  </a>\n  {% if show_quick_add %}\n    {% form 'product', product %}\n      <input type=\"hidden\" name=\"id\" value=\"{{ product.selected_or_first_available_variant.id }}\">\n      <button type=\"submit\" class=\"button button--quick-add\">QUICK ADD</button>\n    {% endform %}\n  {% endif %}\n</div>",
    "usage": "{% render 'product-card', product: product, show_quick_add: true %}"
  },
  
  "MEGA_MENU": {
    "file_name": "mega-menu.liquid",
    "description": "Multi-column dropdown navigation (best-in-class from Prestige)",
    "code": "{% comment %}\n  Mega Menu - snippets/mega-menu.liquid\n  Usage: {% render 'mega-menu', link: link %}\n{% endcomment %}\n\n{% if link.links.size > 0 %}\n  <div class=\"mega-menu\" data-mega-menu=\"{{ link.handle }}\">\n    <div class=\"mega-menu__container\">\n      <div class=\"mega-menu__grid\">\n        {% for childlink in link.links limit: 4 %}\n          <div class=\"mega-menu__column\">\n            <h4 class=\"mega-menu__heading\">\n              <a href=\"{{ childlink.url }}\">{{ childlink.title }}</a>\n            </h4>\n            {% if childlink.links.size > 0 %}\n              <ul class=\"mega-menu__list\">\n                {% for grandchild in childlink.links %}\n                  <li><a href=\"{{ grandchild.url }}\">{{ grandchild.title }}</a></li>\n                {% endfor %}\n              </ul>\n            {% endif %}\n          </div>\n        {% endfor %}\n      </div>\n    </div>\n  </div>\n{% endif %}",
    
    "required_js": "// Mega Menu JS\nclass MegaMenu {\n  constructor() {\n    this.menuItems = document.querySelectorAll('.has-mega-menu');\n    this.activeMenu = null;\n    this.hoverDelay = 300;\n    this.leaveDelay = 200;\n    this.init();\n  }\n  \n  init() {\n    this.menuItems.forEach(item => {\n      let enterTimer, leaveTimer;\n      \n      item.addEventListener('mouseenter', () => {\n        clearTimeout(leaveTimer);\n        enterTimer = setTimeout(() => {\n          this.open(item);\n        }, this.hoverDelay);\n      });\n      \n      item.addEventListener('mouseleave', () => {\n        clearTimeout(enterTimer);\n        leaveTimer = setTimeout(() => {\n          this.close();\n        }, this.leaveDelay);\n      });\n    });\n  }\n  \n  open(item) {\n    this.close();\n    const menu = item.querySelector('[data-mega-menu]');\n    if (menu) {\n      menu.classList.add('is-open');\n      this.activeMenu = menu;\n    }\n  }\n  \n  close() {\n    if (this.activeMenu) {\n      this.activeMenu.classList.remove('is-open');\n      this.activeMenu = null;\n    }\n  }\n}\n\nnew MegaMenu();",
    "usage": "In header: <li class=\"has-mega-menu\">{% render 'mega-menu', link: link %}</li>"
  },
  
  "COLLECTION_FILTERS": {
    "file_name": "collection-filters.liquid",
    "description": "AJAX фильтры (sidebar desktop, drawer mobile)",
    "code": "{% comment %}\n  Collection Filters - sections/collection-filters.liquid\n{% endcomment %}\n\n<div class=\"filters\" data-filters>\n  <div class=\"filters__sidebar\">\n    <h3 class=\"filters__title\">Filter by</h3>\n    \n    {% comment %} Price Range {% endcomment %}\n    <div class=\"filter-group\">\n      <h4>Price</h4>\n      <div class=\"filter-group__content\">\n        <input type=\"range\" min=\"0\" max=\"{{ collection.products | map: 'price' | max }}\" data-filter=\"price-min\" value=\"0\">\n        <input type=\"range\" min=\"0\" max=\"{{ collection.products | map: 'price' | max }}\" data-filter=\"price-max\" value=\"{{ collection.products | map: 'price' | max }}\">\n      </div>\n    </div>\n    \n    {% comment %} Product Type {% endcomment %}\n    {% assign product_types = collection.products | map: 'type' | uniq %}\n    <div class=\"filter-group\">\n      <h4>Type</h4>\n      <div class=\"filter-group__content\">\n        {% for type in product_types %}\n          <label>\n            <input type=\"checkbox\" name=\"filter.p.product_type\" value=\"{{ type }}\" data-filter=\"type\">\n            {{ type }}\n          </label>\n        {% endfor %}\n      </div>\n    </div>\n    \n    {% comment %} Tags {% endcomment %}\n    {% assign all_tags = collection.all_tags %}\n    <div class=\"filter-group\">\n      <h4>Tags</h4>\n      <div class=\"filter-group__content\">\n        {% for tag in all_tags limit: 10 %}\n          <label>\n            <input type=\"checkbox\" name=\"filter.v.tag\" value=\"{{ tag }}\" data-filter=\"tag\">\n            {{ tag }}\n          </label>\n        {% endfor %}\n      </div>\n    </div>\n    \n    <button class=\"button button--secondary\" data-filter-clear>Clear All</button>\n  </div>\n  \n  <div class=\"filters__results\" data-filter-results>\n    <div class=\"filters__active\" data-active-filters></div>\n    <div class=\"products-grid\" data-products-grid>\n      {% for product in collection.products %}\n        {% render 'product-card', product: product %}\n      {% endfor %}\n    </div>\n    <div class=\"filters__count\">{{ collection.products_count }} products</div>\n  </div>\n</div>",
    
    "required_js": "// Collection Filters AJAX\nclass CollectionFilters {\n  constructor() {\n    this.filterInputs = document.querySelectorAll('[data-filter]');\n    this.resultsContainer = document.querySelector('[data-products-grid]');\n    this.activeFilters = {};\n    this.init();\n  }\n  \n  init() {\n    this.filterInputs.forEach(input => {\n      input.addEventListener('change', () => this.applyFilters());\n    });\n    \n    document.querySelector('[data-filter-clear]')?.addEventListener('click', () => this.clearFilters());\n  }\n  \n  applyFilters() {\n    const formData = new FormData();\n    \n    this.filterInputs.forEach(input => {\n      if (input.type === 'checkbox' && input.checked) {\n        formData.append(input.name, input.value);\n      }\n    });\n    \n    const params = new URLSearchParams(formData).toString();\n    this.updateResults(params);\n  }\n  \n  async updateResults(params) {\n    const url = `${window.location.pathname}?${params}&section_id=collection`;\n    const res = await fetch(url);\n    const html = await res.text();\n    \n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n    const newGrid = doc.querySelector('[data-products-grid]');\n    \n    if (newGrid) {\n      this.resultsContainer.innerHTML = newGrid.innerHTML;\n    }\n    \n    history.pushState({}, '', `?${params}`);\n  }\n  \n  clearFilters() {\n    this.filterInputs.forEach(input => {\n      if (input.type === 'checkbox') input.checked = false;\n    });\n    this.applyFilters();\n  }\n}\n\nnew CollectionFilters();"
  },
  
  "QUICK_SHOP_MODAL": {
    "file_name": "quick-shop-modal.liquid",
    "description": "Quick shop modal (add to cart from collection page)",
    "code": "{% comment %}\n  Quick Shop Modal - snippets/quick-shop-modal.liquid\n{% endcomment %}\n\n<div class=\"modal quick-shop-modal\" id=\"quick-shop-{{ product.id }}\" data-quick-shop-modal hidden>\n  <div class=\"modal__overlay\" data-modal-close></div>\n  <div class=\"modal__container\">\n    <button class=\"modal__close\" data-modal-close>&times;</button>\n    \n    <div class=\"quick-shop__content\">\n      <div class=\"quick-shop__image\">\n        {{ product.featured_image | image_url: width: 600 | image_tag }}\n      </div>\n      \n      <div class=\"quick-shop__info\">\n        <h3>{{ product.title }}</h3>\n        <div class=\"price\">{{ product.price | money }}</div>\n        \n        {% form 'product', product, id: 'quick-add-form' %}\n          {% if product.variants.size > 1 %}\n            <div class=\"variant-selector\">\n              <label>Variant</label>\n              <select name=\"id\">\n                {% for variant in product.variants %}\n                  <option value=\"{{ variant.id }}\" {% unless variant.available %}disabled{% endunless %}>\n                    {{ variant.title }} - {{ variant.price | money }}\n                  </option>\n                {% endfor %}\n              </select>\n            </div>\n          {% else %}\n            <input type=\"hidden\" name=\"id\" value=\"{{ product.selected_or_first_available_variant.id }}\">\n          {% endif %}\n          \n          <div class=\"quantity-selector\">\n            <label>Quantity</label>\n            <input type=\"number\" name=\"quantity\" value=\"1\" min=\"1\">\n          </div>\n          \n          <button type=\"submit\" class=\"button button--primary button--full-width\">\n            ADD TO CART\n          </button>\n        {% endform %}\n      </div>\n    </div>\n  </div>\n</div>",
    
    "required_js": "// Quick Shop Modal\ndocument.querySelectorAll('[data-quick-shop-trigger]').forEach(btn => {\n  btn.addEventListener('click', (e) => {\n    e.preventDefault();\n    const productId = btn.dataset.productId;\n    const modal = document.getElementById(`quick-shop-${productId}`);\n    modal.hidden = false;\n    document.body.style.overflow = 'hidden';\n  });\n});\n\ndocument.querySelectorAll('[data-modal-close]').forEach(btn => {\n  btn.addEventListener('click', () => {\n    document.querySelectorAll('.modal').forEach(m => m.hidden = true);\n    document.body.style.overflow = '';\n  });\n});\n\n// AJAX form submission\ndocument.querySelectorAll('#quick-add-form').forEach(form => {\n  form.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    const formData = new FormData(form);\n    const res = await fetch('/cart/add.js', {\n      method: 'POST',\n      body: formData\n    });\n    if (res.ok) {\n      // Trigger cart drawer open\n      document.querySelector('[data-cart-drawer-open]')?.click();\n      form.closest('.modal').hidden = true;\n    }\n  });\n});"
  },
  
  "STICKY_HEADER": {
    "file_name": "sticky-header.liquid",
    "description": "Sticky header (shows on scroll up, hides on scroll down)",
    "code": "{% comment %}\n  Sticky Header - sections/header.liquid\n  Add data-sticky-header to header element\n{% endcomment %}\n\n<header class=\"header\" data-sticky-header>\n  <div class=\"header__container\">\n    <a href=\"/\" class=\"header__logo\">{{ shop.name }}</a>\n    <nav class=\"header__nav\">\n      {% for link in linklists.main-menu.links %}\n        <a href=\"{{ link.url }}\">{{ link.title }}</a>\n      {% endfor %}\n    </nav>\n    <div class=\"header__icons\">\n      <a href=\"/search\" aria-label=\"Search\">Search</a>\n      <a href=\"/account\" aria-label=\"Account\">Account</a>\n      <button data-cart-drawer-open aria-label=\"Cart\">Cart ({{ cart.item_count }})</button>\n    </div>\n  </div>\n</header>",
    
    "required_js": "// Sticky Header\nclass StickyHeader {\n  constructor() {\n    this.header = document.querySelector('[data-sticky-header]');\n    this.lastScroll = 0;\n    this.scrollThreshold = 100;\n    this.init();\n  }\n  \n  init() {\n    window.addEventListener('scroll', () => this.handleScroll());\n  }\n  \n  handleScroll() {\n    const currentScroll = window.pageYOffset;\n    \n    if (currentScroll < this.scrollThreshold) {\n      this.header.classList.remove('header--hidden', 'header--sticky');\n      return;\n    }\n    \n    if (currentScroll > this.lastScroll) {\n      // Scrolling down - hide\n      this.header.classList.add('header--hidden');\n    } else {\n      // Scrolling up - show\n      this.header.classList.remove('header--hidden');\n      this.header.classList.add('header--sticky');\n    }\n    \n    this.lastScroll = currentScroll;\n  }\n}\n\nnew StickyHeader();",
    "required_css": ".header { transition: transform 0.3s; } .header--sticky { position: fixed; top: 0; width: 100%; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.1); } .header--hidden { transform: translateY(-100%); }"
  },
  
  "NEWSLETTER_POPUP": {
    "file_name": "newsletter-popup.liquid",
    "description": "Email capture popup (appears after delay or exit intent)",
    "code": "{% comment %}\n  Newsletter Popup - snippets/newsletter-popup.liquid\n{% endcomment %}\n\n<div class=\"modal newsletter-popup\" data-newsletter-popup hidden>\n  <div class=\"modal__overlay\" data-modal-close></div>\n  <div class=\"modal__container\">\n    <button class=\"modal__close\" data-modal-close>&times;</button>\n    \n    <div class=\"newsletter-popup__content\">\n      <h3>{{ section.settings.heading | default: 'Get 10% Off' }}</h3>\n      <p>{{ section.settings.text | default: 'Subscribe to our newsletter and get 10% off your first order' }}</p>\n      \n      {% form 'customer', class: 'newsletter-form' %}\n        <input type=\"hidden\" name=\"contact[tags]\" value=\"newsletter\">\n        <div class=\"newsletter-form__input-group\">\n          <input \n            type=\"email\" \n            name=\"contact[email]\" \n            placeholder=\"Your email\"\n            required\n            aria-label=\"Email address\"\n          >\n          <button type=\"submit\" class=\"button button--primary\">SUBSCRIBE</button>\n        </div>\n      {% endform %}\n      \n      <label class=\"newsletter-popup__dismiss\">\n        <input type=\"checkbox\" data-newsletter-dismiss-forever>\n        Don't show again\n      </label>\n    </div>\n  </div>\n</div>",
    
    "required_js": "// Newsletter Popup\nclass NewsletterPopup {\n  constructor() {\n    this.popup = document.querySelector('[data-newsletter-popup]');\n    this.delay = 5000; // 5 seconds\n    this.exitIntentEnabled = true;\n    this.init();\n  }\n  \n  init() {\n    if (localStorage.getItem('newsletter-dismissed')) return;\n    \n    // Show after delay\n    setTimeout(() => this.show(), this.delay);\n    \n    // Exit intent\n    if (this.exitIntentEnabled) {\n      document.addEventListener('mouseleave', (e) => {\n        if (e.clientY < 10) this.show();\n      });\n    }\n    \n    // Dismiss forever checkbox\n    document.querySelector('[data-newsletter-dismiss-forever]')?.addEventListener('change', (e) => {\n      if (e.target.checked) {\n        localStorage.setItem('newsletter-dismissed', 'true');\n      }\n    });\n  }\n  \n  show() {\n    if (!localStorage.getItem('newsletter-dismissed')) {\n      this.popup.hidden = false;\n      document.body.style.overflow = 'hidden';\n    }\n  }\n}\n\nnew NewsletterPopup();"
  },
  
  "PRODUCT_RECOMMENDATIONS": {
    "file_name": "product-recommendations.liquid",
    "description": "AI-powered product recommendations (You may also like)",
    "code": "{% comment %}\n  Product Recommendations - sections/product-recommendations.liquid\n  Use on product page\n{% endcomment %}\n\n<div class=\"product-recommendations\" data-recommendations data-product-id=\"{{ product.id }}\">\n  <h2>{{ section.settings.heading | default: 'You May Also Like' }}</h2>\n  <div class=\"product-recommendations__grid\" data-recommendations-grid>\n    {% comment %} Recommendations load via JS {% endcomment %}\n  </div>\n</div>",
    
    "required_js": "// Product Recommendations\nclass ProductRecommendations {\n  constructor() {\n    this.container = document.querySelector('[data-recommendations]');\n    if (!this.container) return;\n    \n    this.productId = this.container.dataset.productId;\n    this.grid = this.container.querySelector('[data-recommendations-grid]');\n    this.load();\n  }\n  \n  async load() {\n    const url = `/recommendations/products.json?product_id=${this.productId}&limit=4`;\n    const res = await fetch(url);\n    const data = await res.json();\n    \n    if (data.products && data.products.length > 0) {\n      this.render(data.products);\n    } else {\n      this.container.hidden = true;\n    }\n  }\n  \n  render(products) {\n    const html = products.map(product => `\n      <div class=\"product-card\">\n        <a href=\"${product.url}\">\n          <img src=\"${product.featured_image}\" alt=\"${product.title}\" loading=\"lazy\">\n          <h4>${product.title}</h4>\n          <span>${Shopify.formatMoney(product.price)}</span>\n        </a>\n      </div>\n    `).join('');\n    \n    this.grid.innerHTML = html;\n  }\n}\n\nnew ProductRecommendations();"
  },
  
  "ANNOUNCEMENT_BAR": {
    "file_name": "announcement-bar.liquid",
    "description": "Rotating announcement bar (auto-rotates messages)",
    "code": "{% comment %}\n  Announcement Bar - sections/announcement-bar.liquid\n{% endcomment %}\n\n<div class=\"announcement-bar\" data-announcement-bar>\n  <div class=\"announcement-bar__slides\" data-slides>\n    {% for block in section.blocks %}\n      <div class=\"announcement-bar__slide\" data-slide>\n        {{ block.settings.text }}\n        {% if block.settings.link %}\n          <a href=\"{{ block.settings.link }}\" class=\"announcement-bar__link\">{{ block.settings.link_text }}</a>\n        {% endif %}\n      </div>\n    {% endfor %}\n  </div>\n  \n  {% if section.blocks.size > 1 %}\n    <button class=\"announcement-bar__close\" data-announcement-close aria-label=\"Close\">&times;</button>\n  {% endif %}\n</div>\n\n{% schema %}\n{\n  \"name\": \"Announcement Bar\",\n  \"max_blocks\": 5,\n  \"blocks\": [\n    {\n      \"type\": \"announcement\",\n      \"name\": \"Announcement\",\n      \"settings\": [\n        {\"type\": \"text\", \"id\": \"text\", \"label\": \"Text\"},\n        {\"type\": \"url\", \"id\": \"link\", \"label\": \"Link\"},\n        {\"type\": \"text\", \"id\": \"link_text\", \"label\": \"Link Text\"}\n      ]\n    }\n  ]\n}\n{% endschema %}",
    
    "required_js": "// Announcement Bar Auto-Rotate\nclass AnnouncementBar {\n  constructor() {\n    this.bar = document.querySelector('[data-announcement-bar]');\n    if (!this.bar) return;\n    \n    this.slides = this.bar.querySelectorAll('[data-slide]');\n    if (this.slides.length <= 1) return;\n    \n    this.currentSlide = 0;\n    this.interval = 5000; // 5 seconds\n    this.init();\n  }\n  \n  init() {\n    this.rotate();\n    \n    document.querySelector('[data-announcement-close]')?.addEventListener('click', () => {\n      this.bar.hidden = true;\n    });\n  }\n  \n  rotate() {\n    setInterval(() => {\n      this.slides[this.currentSlide].classList.remove('is-active');\n      this.currentSlide = (this.currentSlide + 1) % this.slides.length;\n      this.slides[this.currentSlide].classList.add('is-active');\n    }, this.interval);\n    \n    this.slides[0].classList.add('is-active');\n  }\n}\n\nnew AnnouncementBar();",
    "required_css": ".announcement-bar__slides { position: relative; } .announcement-bar__slide { display: none; } .announcement-bar__slide.is-active { display: block; }"
  }
}
