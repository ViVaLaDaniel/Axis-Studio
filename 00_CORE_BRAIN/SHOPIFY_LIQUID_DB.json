{
  "DATABASE_NAME": "SHOPIFY_LIQUID_DB",
  "VERSION": "1.0",
  "PURPOSE": "Полный референс Shopify Liquid для генерации корректного кода",
  
  "LIQUID_BASICS": {
    "syntax": {
      "output": "{{ variable }}",
      "tag": "{% tag %}",
      "comment": "{% comment %}text{% endcomment %}"
    },
    
    "operators": {
      "comparison": ["==", "!=", ">", "<", ">=", "<="],
      "logical": ["and", "or"],
      "contains": "{% if collection.tags contains 'sale' %}"
    }
  },
  
  "COMMON_OBJECTS": {
    "product": {
      "properties": {
        "title": "Product title",
        "price": "Price in cents (e.g., 2999 = $29.99)",
        "compare_at_price": "Original price if on sale",
        "available": "Boolean - in stock?",
        "featured_image": "Main product image",
        "images": "Array of all images",
        "variants": "Array of variants",
        "url": "Product page URL",
        "id": "Product ID",
        "handle": "URL-friendly identifier",
        "tags": "Array of tags",
        "type": "Product type",
        "vendor": "Brand/vendor"
      },
      
      "example_usage": {
        "title": "{{ product.title }}",
        "price_formatted": "{{ product.price | money }}",
        "on_sale": "{% if product.compare_at_price > product.price %}ON SALE{% endif %}",
        "first_image": "{{ product.featured_image | image_url: width: 600 }}"
      }
    },
    
    "cart": {
      "properties": {
        "item_count": "Number of items",
        "total_price": "Total price in cents",
        "items": "Array of line items",
        "currency": "Currency code (USD, EUR)"
      },
      
      "line_item_properties": {
        "title": "Product title",
        "price": "Line item price",
        "quantity": "Quantity",
        "variant_id": "Variant ID",
        "product_id": "Product ID",
        "image": "Product image"
      }
    },
    
    "collection": {
      "properties": {
        "title": "Collection title",
        "products": "Array of products",
        "products_count": "Total products",
        "url": "Collection URL",
        "image": "Featured image",
        "description": "Collection description"
      }
    },
    
    "shop": {
      "properties": {
        "name": "Store name",
        "currency": "Currency code",
        "money_format": "e.g., '${{amount}}'",
        "url": "Store URL",
        "email": "Contact email"
      }
    }
  },
  
  "FILTERS": {
    "money": {
      "usage": "{{ product.price | money }}",
      "output": "$29.99",
      "options": "money_with_currency, money_without_currency"
    },
    
    "image_url": {
      "usage": "{{ product.featured_image | image_url: width: 600 }}",
      "sizes": "Available: 50-5760 width",
      "format": "Automatically converts to WebP if supported"
    },
    
    "image_tag": {
      "usage": "{{ product.featured_image | image_url: width: 600 | image_tag }}",
      "output": "<img src='...' alt='...' />",
      "loading": "Can add loading='lazy'"
    },
    
    "url_for_vendor": {
      "usage": "{{ product.vendor | url_for_vendor }}",
      "output": "/collections/vendors?q=Brand"
    },
    
    "date": {
      "usage": "{{ 'now' | date: '%B %d, %Y' }}",
      "output": "November 27, 2025"
    },
    
    "default": {
      "usage": "{{ product.title | default: 'No title' }}",
      "use_case": "Fallback value"
    },
    
    "escape": {
      "usage": "{{ user_input | escape }}",
      "importance": "CRITICAL for XSS protection"
    }
  },
  
  "TAGS": {
    "for_loop": {
      "syntax": "{% for product in collection.products %}...{% endfor %}",
      "limit": "{% for product in collection.products limit:8 %}",
      "offset": "{% for product in collection.products offset:8 %}",
      "forloop_variables": {
        "index": "Current iteration (1-indexed)",
        "index0": "Current iteration (0-indexed)",
        "first": "Boolean - first iteration?",
        "last": "Boolean - last iteration?",
        "length": "Total iterations"
      }
    },
    
    "if_elsif_else": {
      "syntax": "{% if condition %}...{% elsif other %}...{% else %}...{% endif %}",
      "example": "{% if product.available %}In Stock{% else %}Sold Out{% endif %}"
    },
    
    "case_when": {
      "syntax": "{% case variable %}{% when 'value1' %}...{% when 'value2' %}...{% else %}...{% endcase %}",
      "usage": "Switch statement alternative"
    },
    
    "assign": {
      "syntax": "{% assign variable_name = value %}",
      "example": "{% assign sale = product.compare_at_price > product.price %}"
    },
    
    "capture": {
      "syntax": "{% capture variable %}...{% endcapture %}",
      "usage": "Capture multi-line content into variable"
    },
    
    "render": {
      "syntax": "{% render 'snippet-name', param: value %}",
      "example": "{% render 'product-card', product: product %}",
      "scope": "Isolated scope (can't access parent variables unless passed)"
    },
    
    "section": {
      "syntax": "{% section 'section-name' %}",
      "usage": "Render section in JSON templates"
    },
    
    "form": {
      "syntax": "{% form 'product', product %}...{% endform %}",
      "types": ["product (ATC)", "cart", "customer_login", "contact", "new_comment"],
      "importance": "CRITICAL - auto-generates CSRF token"
    }
  },
  
  "SCHEMA_BLOCKS": {
    "section_schema": {
      "location": "Bottom of section file",
      "format": "{% schema %} JSON {% endschema %}",
      "example": {
        "name": "Hero Section",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Background Image"
          },
          {
            "type": "text",
            "id": "heading",
            "label": "Heading",
            "default": "Welcome"
          },
          {
            "type": "range",
            "id": "height",
            "min": 400,
            "max": 800,
            "step": 50,
            "unit": "px",
            "label": "Height",
            "default": 600
          }
        ],
        "presets": [
          {
            "name": "Hero",
            "category": "Image"
          }
        ]
      }
    },
    
    "setting_types": {
      "text": "Single line text",
      "textarea": "Multi-line text",
      "richtext": "WYSIWYG editor",
      "html": "Raw HTML input",
      "image_picker": "Image upload",
      "video_url": "YouTube/Vimeo URL",
      "color": "Color picker",
      "color_scheme": "Pre-defined color schemes",
      "font_picker": "Google Fonts selector",
      "checkbox": "Boolean true/false",
      "radio": "Radio buttons",
      "select": "Dropdown",
      "range": "Slider",
      "url": "Link selector",
      "collection": "Collection picker",
      "product": "Product picker",
      "blog": "Blog picker",
      "page": "Page picker"
    },
    
    "blocks": {
      "definition": "Repeatable sub-sections",
      "example": {
        "blocks": [
          {
            "type": "slide",
            "name": "Slide",
            "settings": [
              {"type": "image_picker", "id": "image", "label": "Image"},
              {"type": "text", "id": "heading", "label": "Heading"}
            ]
          }
        ]
      },
      "usage_in_liquid": "{% for block in section.blocks %}...{% endfor %}"
    }
  },
  
  "PERFORMANCE_BEST_PRACTICES": {
    "lazy_loading": {
      "syntax": "{{ image | image_url: width: 600 | image_tag: loading: 'lazy' }}",
      "rule": "Lazy load all images below fold"
    },
    
    "image_sizes": {
      "syntax": "{{ image | image_url: width: 600 | image_tag: sizes: '(min-width: 750px) 50vw, 100vw' }}",
      "importance": "Critical for LCP"
    },
    
    "preload_critical_images": {
      "syntax": "<link rel='preload' as='image' href='{{ hero_image | image_url: width: 1200 }}'>",
      "usage": "Above-fold hero images"
    },
    
    "defer_js": {
      "syntax": "<script src='{{ 'script.js' | asset_url }}' defer></script>",
      "rule": "Defer all non-critical JS"
    }
  },
  
  "SECURITY": {
    "xss_prevention": {
      "rule": "ALWAYS escape user input",
      "filter": "{{ user_input | escape }}",
      "examples": {
        "search_query": "{{ search.terms | escape }}",
        "blog_comment": "{{ comment.content | escape }}"
      }
    },
    
    "csrf_protection": {
      "rule": "ALWAYS use {% form %} tag for forms",
      "why": "Auto-generates CSRF token",
      "bad": "<form action='/cart/add'>",
      "good": "{% form 'product', product %}"
    }
  },
  
  "COMMON_PATTERNS": {
    "product_card": {
      "template": "{% render 'product-card', product: product, show_quick_add: true %}",
      "params": ["product", "show_quick_add", "show_vendor", "image_ratio"]
    },
    
    "money_formatting": {
      "pattern": "<span class='price'>{{ product.price | money }}</span>",
      "sale_pattern": "<s>{{ product.compare_at_price | money }}</s> {{ product.price | money }}"
    },
    
    "variant_selector": {
      "pattern": "<select name='id'>{% for variant in product.variants %}<option value='{{ variant.id }}'>{{ variant.title }} - {{ variant.price | money }}</option>{% endfor %}</select>"
    }
  }
}
